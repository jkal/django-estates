{% extends "base.html" %}

{% block title %}
Add new estate
{% endblock %}

{% block script %}
<script type="text/javascript">
var geocoder;
var map;

function initialize() {
    geocoder = new google.maps.Geocoder();
    var latlng = new google.maps.LatLng(-34.397, 150.644);
    var myOptions = {
        zoom: 15,
        center: latlng,
        mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    map = new google.maps.Map(document.getElementById("new-place-map"), myOptions);
}

function codeAddress() {
    var address = $("#id_address").val();
    var city = $("#id_city").val();
    var zipcode = $("#id_zipcode").val();
    var country = $("#id_country").val();
    var fulladdr = address + ', ' + city + ', ' + country;
    
    if (geocoder) {
        geocoder.geocode( { 'address': fulladdr}, function(results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
                map.setCenter(results[0].geometry.location);
                $("input[name=latitude]").attr('value', results[0].geometry.location.lat());
                $("input[name=longitude]").attr('value', results[0].geometry.location.lng());
                var marker = new google.maps.Marker({
                    map: map, 
                    position: results[0].geometry.location
                });
            } else {
                alert("Geocode was not successful for the following reason: " + status);
            }
        });
    }
}

$(document).ready(function(){
    initialize();
    $("label").inFieldLabels();
    $("#new-place-form").formToWizard({ submitButton: 'new-place-submit' })

    $(".next").click(function() {
        codeAddress();
    });
});
</script>
{% endblock %}

{% block content %}

<ul id="posts" >
    <li class="post">
        <h3><a href="" title="">New Place</a></h3>
        <div class="post-content">
            {% include "places/new_form.html" %}
        </div>
    </li>
</ul>


{% endblock %}
