{% extends "base.html" %}
{% load i18n %}

{% block title %} 
    {% blocktrans %}All places{% endblocktrans %}
{% endblock %}

{% block head %}
<script type="text/javascript" charset="utf-8">
    $(document).ready(function() {
        
        $.getJSON("http://localhost:8000/places/json/", function(data) {
            $.each(data, function(i, item) {
                $("#box-table-a tbody").append(
                    '<tr>' + 
                        '<td>' + item.fields.address + '</a></td>' +
                        '<td>' + item.fields.city + '</td>' +
                        '<td>' + item.fields.category +'</td>' +
                        '<td>' + item.fields.area +'</td>' +
                        '<td>' + item.fields.price +'</td>' +
                    '</tr>');
            });
        });
        $("#all-places .loading").remove();
        $("#box-table-a").show();
    
        $("#filter-input").keyup(function () {
            var filter = $(this).val().toLowerCase(), count = 0;
            
            $("#box-table-a tr").each(function(i, e) {
                count = 0;
                // select the td elements of each tr, as we can't manipulate with visibility of tr
                var myChildren = $(this).children("td");
                
                // get the text of all td elements
                tr_data = $(this).text().toLowerCase();
                
                if (tr_data.indexOf(filter) == -1 ) {
                    myChildren.fadeOut();
                } else {
                    myChildren.fadeIn();
                }
            });
            $("#filter-count").text(count);
        });
    });
</script>
{% endblock %}

{% block content %} 

{% include "menu.html" %} 

<ul id="posts">
    <noscript>
        <center style="padding: 20px;">
        {% trans 'This page requires JavaScript enabled. Defaulting to plain view.' %}
        </center>
    </noscript>
    
    <li class="post">
        <h3>
            {% trans 'Searching for' %}: 
            {% if filter_on %}
                <span id="searching-for">"{{ filter_on }}"</span>
                <a id="reset-filter">{% trans 'Reset filter' %}</a>
            {% else %}
                <span id="searching-for">{% trans 'All places' %}</span>
            {% endif %}
        </h3>
        
        <div class="post-content">
            <div id='filter-input-box' style="padding:20px 0px;">
                <input id="filter-input" name="filter" size="40"/>
                <span class="small">Showing <span id="filter-count">{{ places_list|length}}</span> of {{ places_list|length}} places.</span>
            </div>
            
            <div id="all-places" class="filtered">
                <span class="loading">Loading places...</span>
                
                <table id="box-table-a" summary="All places" style="display:none">
                    <thead>
                    	<tr>
                        	<th scope="col">Address</th>
                            <th scope="col">City</th>
                            <th scope="col">Category</th>
                            <th scope="col">Price</th>
                            <th scope="col">Area</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                
            </div>
        </div>    
    </li>
</ul>

{% endblock %}
