{% extends "base.html" %}
{% load disqus_tags %}
{% load thumbnail %}

{% block title %}
    {{ place }}
{% endblock %}

{% block head %}
<link type="text/css" rel="stylesheet" href="{{ MEDIA_URL }}css/notifybar.css" /> 
<link type="text/css" rel="stylesheet" href="{{ MEDIA_URL }}css/colorbox.css" />
<script type="text/javascript" src="{{ MEDIA_URL }}js/jquery.notifybar.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}js/jquery.colorbox-min.js"></script>

<script>
$(document).ready(function() {

    $("a[rel='photos']").colorbox();

    $("#favlink").click(function() {
        $.ajax({
            type: "GET",
            url: "{% url fave-place place.pk %}",
            data: " ",
            cache: false,
                
            success: function(data) {
                $.notifyBar({
                    html: data,
                    delay: 2000,
                    animationSpeed: "normal"
                });
            },  
            error: function(textStatus) { 
                $.notifyBar({ cls: "error", html: "AJAX request failed:" + textStatus });
            },
        }); 
    });

    var myLatlng = new google.maps.LatLng({{ place.latitude }}, {{ place.longitude }});
    var myOptions = {
        zoom: 15,
        center: myLatlng,
        mapTypeControl: true,
        mapTypeControlOptions: { style: google.maps.MapTypeControlStyle.DROPDOWN_MENU },
        navigationControl: true,
        navigationControlOptions: { style: google.maps.NavigationControlStyle.SMALL },
        mapTypeId: google.maps.MapTypeId.ROADMAP
    }
    
    var map = new google.maps.Map(document.getElementById("map"), myOptions);
    var marker = new google.maps.Marker({
        position: myLatlng, 
        map: map, 
        title:"{{ place }}"
    });  
});
</script>
{% endblock %}

{% block content %}
<style>
.round {
    background-color:#747474;-moz-border-radius:3px 3px 3px 3px; -webkit-border-radius:3px 3px 3px 3px; color:white; padding:0 3px;
}
a.round-red {
    font-size: 60%; background-color:#dd0000;-moz-border-radius:3px 3px 3px 3px; -webkit-border-radius:3px 3px 3px 3px; color:white; padding:0 3px;
}
a.round-blue {
    font-size: 60%; background-color:#5f99cf;-moz-border-radius:3px 3px 3px 3px; -webkit-border-radius:3px 3px 3px 3px; color:white; padding:0 3px;
}
a.round-other {
    font-size: 60%; background-color:#5F99CF;-moz-border-radius:3px 3px 3px 3px; -webkit-border-radius:3px 3px 3px 3px; color:white; padding:0 3px;
}
</style>

{% include "menu.html" %}

<ul id="posts" >

    <li class="post">
        <h4>
            {{ place.address}}, {{ place.city}}
            {% if place.submitter == user %}
                <a class="round-red" title="You can delete this place." href="{% url delete-place place.pk %}">Delete<a>
            {% endif %}
            {% if user.is_authenticated %}
                <a class="round-blue" id="favlink" style="padding-left: 5px;">Like!</a>
            {% endif %}
        </h4>
        
        <div class="side-map">
            <noscript>
                <center style="padding: 100px;">
                    Maps require JavaScript enabled.
                </center>
            </noscript>
            <div id="map" style="height: 100%;"></div>
        </div>
        
        <div class="meta">
            {% if place.action = 'S' %}
                <span class="round">Προς πώληση</span>
            {% else %}
                <span class="round">Προς ενοικίαση</span>
            {% endif %}            
            {{ place.category }} &bull; {{ place.area }} τ.μ. &bull; {{ place.price }} €
        </div>

        <div class="post-content">
            <strong style="border-bottom: 1px dotted #CCCCCC;">Πληροφορίες</strong>
            <p>{{ place.description }}</p>
            <p><em>Έτος Κατασκευής: </em>{{ place.year }}</p>
        </div>

        <div class="images">
			{% if photos %}
				{% for p in photos %}
            		<a rel="photos" title="Escape to close" href="{{ p.pic.url }}">
                        <img src="{% thumbnail p.pic 100x50 %}" width="60" height="60"/>
					</a>
				{% endfor %}
			{% else %}
				No photos submitted.
			{% endif %}
        </div>
        
        <div class="date">
            Submitted on {{ place.pub_date }} by {{ place.submitter.username }}.
            Views: {{ place.hits }}
        </div>
    </li>
</ul>

<div id="comments">
    {% disqus_dev %}
    {# {% disqus_show_comments %} #}
</div>

{% endblock %}
